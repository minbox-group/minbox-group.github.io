<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="keywords" content="api-boot-http-message-converter" />
  <meta name="description" content="api-boot-http-message-converter" />
  <!-- 网页标签标题 -->
  <title>ApiBoot Http Message Converter 使用文档</title>
  <link rel="shortcut icon" href="/img/favicon.ico" />
  <link rel="stylesheet" href="/build/documentation.css" />
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-149679255-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-149679255-1');
  </script>
</head>

<body>
  <div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="/img/apiboot-colorful.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">En</span><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="/zh-cn/index.html" target="_self">首页</a></li><li class="menu-item menu-item-normal"><a href="https://gitee.com/minbox-projects/api-boot-admin" target="_self">ApiBoot + Vue = Admin</a></li><li class="menu-item menu-item-normal"><a href="https://blog.yuqiyu.com" target="_self">作者博客</a></li><li class="menu-item menu-item-normal"><a href="https://blog.yuqiyu.com/apiboot-all-articles.html" target="_self">组件使用文章</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a href="/zh-cn/docs/quick-start.html" target="_self">文档</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>ApiBoot 文档</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>ApiBoot</span><ul><li style="height:144px;overflow:hidden" class="menu-item menu-item-level-2"><span>ApiBoot是什么？<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/introduce.html" target="_self">ApiBoot简介</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/faq.html" target="_self">FAQ</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/update-log.html" target="_self">更新日志</a></li></ul></li><li style="height:288px;overflow:hidden" class="menu-item menu-item-level-2"><span>ApiBoot往期版本文档<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/history-reference-guide.html" target="_self">往期文档说明</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.1.5.RELEASE/reference-guide.html" target="_self">2.1.5.RELEASE</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.1.4.RELEASE/reference-guide.html" target="_self">2.1.4.RELEASE</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.1.3.RELEASE/reference-guide.html" target="_self">2.1.3.RELEASE</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.1.2.RELEASE/reference-guide.html" target="_self">2.1.2.RELEASE</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.1.1.RELEASE/reference-guide.html" target="_self">2.1.1.RELEASE</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.1.0.RELEASE/reference-guide.html" target="_self">2.1.0.RELEASE</a></li></ul></li><li style="height:756px;overflow:hidden" class="menu-item menu-item-level-2"><span>快速开始<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/quick-start.html" target="_self">第一个ApiBoot应用程序</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/version-rely.html" target="_self">版本依赖</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-logging-admin-ui.html" target="_self">ApiBoot Logging Admin UI</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-logging-admin.html" target="_self">ApiBoot Logging Admin</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-logging.html" target="_self">ApiBoot Logging</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-security.html" target="_self">ApiBoot Security</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-oauth.html" target="_self">ApiBoot OAuth</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-swagger.html" target="_self">ApiBoot Swagger</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-quartz.html" target="_self">ApiBoot Quartz</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-rate-limiter.html" target="_self">ApiBoot RateLimiter</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-datasource-switch.html" target="_self">ApiBoot DataSource Switch</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-mybatis-enhance.html" target="_self">ApiBoot Mybatis Enhance</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-mybatis-enhance-codegen.html" target="_self">ApiBoot Mybatis Enhance Codegen</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-mybatis-pageable.html" target="_self">ApiBoot Mybatis Pageable</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-resource-load.html" target="_self">ApiBoot Resource Load</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-message-push.html" target="_self">ApiBoot Message Push</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-http-message-converter.html" target="_self">ApiBoot HttpMessage Converter</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-oss.html" target="_self">ApiBoot AliYun OSS</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-mail.html" target="_self">ApiBoot AliYun Mail</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-sms.html" target="_self">ApiBoot AliYun SMS</a></li></ul></li><li style="height:144px;overflow:hidden" class="menu-item menu-item-level-2"><span>运维指南<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/deploy.html" target="_self">打包部署</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/domain.html" target="_self">域名解析</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/nginx-load-balance.html" target="_self">Nginx负载均衡</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>开源共建<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/contribution.html" target="_self">贡献源码</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/conventions.html" target="_self">编码约定</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/new-starter.html" target="_self">新建组件</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-plan.html" target="_self">ApiBoot规划</a></li></ul></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>ApiBoot 整合 阿里系FastJSON完成响应数据格式化</h1>
<p><code>FastJson</code>是阿里巴巴提供的一款<code>Json</code>格式化插件。</p>
<p><code>ApiBoot</code>提供了<code>FastJson</code>驱动转换接口请求的<code>Json</code>字符串数据，添加该依赖后会自动格式化时间(格式：YYYY-MM-DD HH:mm:ss)、空对象转换为空字符串返回、空Number转换为0等，还会自动装载<code>ValueFilter</code>接口的实现类来完成自定义的数据格式转换。</p>
<h2>引入Http Converter</h2>
<p><code>ApiBoot Http Converter</code>使用非常简单，只需要在<code>pom.xml</code>添加如下依赖：</p>
<pre><code class="language-xml"><span class="hljs-comment">&lt;!--ApiBoot Http Converter--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.minbox.framework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>api-boot-starter-http-converter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<blockquote>
<p>注意：如果未添加<code>ApiBoot</code>版本依赖，请访问<a href="/zh-cn/docs/version-rely.html">版本依赖</a>查看添加方式。</p>
</blockquote>
<h2>相关配置</h2>
<p><code>ApiBoot Http Converter</code>通过使用<code>SpringBoot</code>内置的配置参数名来确定是否开启，在<code>SpringBoot</code>内可以通过<code>spring.http.converters.preferred-json-mapper</code>来修改首选的<code>Json</code>格式化插件，<code>SpringBoot</code>已经提供了三种，分别是：<code>gson</code>、<code>jackson</code>、<code>jsonb</code>，当我们配置该参数为<code>fastJson</code>或<code>不进行配置</code>就会使用<code>ApiBoot Http Converter</code>提供的<code>fastJson</code>来格式化转换<code>Json</code>返回数据。</p>
<p>如下所示：</p>
<pre><code class="language-yaml"><span class="hljs-attr">spring:</span>
<span class="hljs-attr">  http:</span>
<span class="hljs-attr">    converters:</span>
      <span class="hljs-comment"># 不配置默认使用fastJson</span>
<span class="hljs-attr">      preferred-json-mapper:</span> <span class="hljs-string">fastJson</span>

</code></pre>
<h2>内置ValueFilter注解</h2>
<table>
<thead>
<tr>
<th>注解名称</th>
<th>ValueFilter实现类</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@ApiBootValueHide</code></td>
<td><code>ValueHideFilter</code></td>
<td>用于格式化隐藏标注的字符串字段的值</td>
</tr>
<tr>
<td><code>@ApiBootDecimalAccuracy</code></td>
<td><code>DecimalAccuracyFilter</code></td>
<td>用于格式化BigDecimal类型字段的精度、小数点位数等</td>
</tr>
</tbody>
</table>
<h4>@ApiBootValueHide</h4>
<p>可配置参数：</p>
<ul>
<li><code>length</code>：隐藏的字节长度</li>
<li><code>start</code>：开始隐藏的字节索引位置</li>
<li><code>position</code>：位置类型，具体查看<code>ValueHidePositionEnum</code>枚举</li>
<li><code>placeholder</code>：隐藏后被替换的字符，默认为：<code>*</code></li>
</ul>
<h4>@ApiBootDecimalAccuracy</h4>
<p>可配置参数：</p>
<ul>
<li><code>scale</code>：小数点位数，默认为<code>2</code></li>
<li><code>roundingMode</code>：小数点精度模式，默认为<code>BigDecimal.ROUND_DOWN</code>，具体查看<code>BigDecimal</code>的rounding mode</li>
</ul>
<h2>自定义ValueFilter</h2>
<p><code>ValueFilter</code>是<code>FastJson</code>的概念，用于自定义转换实现，比如：自定义格式化日期、自动截取小数点等。</p>
<p>下面提供一个<code>ValueFilter</code>的简单示例，具体的使用请参考<code>FastJson</code>官方文档。</p>
<h3>ValueFilter示例</h3>
<p>在使用<code>ValueFilter</code>时一般都会搭配一个对应的自定义<code>@Annotation</code>来进行组合使用，保留自定义小数点位数的示例如下所示：</p>
<p><strong>创建 BigDecimalFormatter Annotation</strong></p>
<pre><code class="language-java"><span class="hljs-meta">@Target</span>({ElementType.METHOD, ElementType.FIELD, ElementType.PARAMETER})
<span class="hljs-meta">@Retention</span>(RetentionPolicy.RUNTIME)
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> BigDecimalFormatter {
    <span class="hljs-comment">/**
     * 小数位数，默认保留两位
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">scale</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> 2</span>;
}
</code></pre>
<p><strong>创建 BigDecimal ValueFilter</strong></p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BigDecimalValueFilter</span>
        <span class="hljs-keyword">implements</span> <span class="hljs-title">ValueFilter</span> </span>{
    <span class="hljs-comment">/**
     * logback
     */</span>
    Logger logger = LoggerFactory.getLogger(BigDecimalValueFilter.class);

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> object 对象
     * <span class="hljs-doctag">@param</span> name   对象的字段的名称
     * <span class="hljs-doctag">@param</span> value  对象的字段的值
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">process</span><span class="hljs-params">(Object object, String name, Object value)</span> </span>{
        <span class="hljs-keyword">if</span> (ValidateTools.isEmpty(value) || !(value <span class="hljs-keyword">instanceof</span> BigDecimal)) {
            <span class="hljs-keyword">return</span> value;
        }
        <span class="hljs-keyword">return</span> convertValue(object, name, value);
    }

    <span class="hljs-comment">/**
     * 转换值
     *
     * <span class="hljs-doctag">@param</span> object 字段所属对象实例
     * <span class="hljs-doctag">@param</span> name   字段名称
     * <span class="hljs-doctag">@param</span> value  字段的值
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-function">Object <span class="hljs-title">convertValue</span><span class="hljs-params">(Object object, String name, Object value)</span> </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">/**
             * 反射获取field
             */</span>
            Field field = object.getClass().getDeclaredField(name);
            <span class="hljs-comment">/**
             *判断字段是否存在<span class="hljs-doctag">@BigDecimalFormatter</span>注解
             */</span>
            <span class="hljs-keyword">if</span> (field.isAnnotationPresent(BigDecimalFormatter.class)) {
                BigDecimalFormatter bigDecimalFormatter = field.getAnnotation(BigDecimalFormatter.class);
                <span class="hljs-comment">// 执行格式化</span>
                BigDecimal decimal = (BigDecimal) value;
                System.out.println(bigDecimalFormatter.scale());
                <span class="hljs-comment">// 保留小数位数，删除多余</span>
                value = decimal.setScale(bigDecimalFormatter.scale(), BigDecimal.ROUND_DOWN).doubleValue();
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            logger.error(<span class="hljs-string">"格式化BigDecimal字段出现异常：{}"</span>, e.getMessage());
        }
        <span class="hljs-keyword">return</span> value;
    }
}
</code></pre>
<p><strong>使用 BigDecimalFormatter Annotation</strong></p>
<pre><code class="language-java"><span class="hljs-meta">@BigDecimalFormatter</span>
<span class="hljs-keyword">private</span> BigDecimal decimalValue;
</code></pre>
</div></section><footer class="footer-container"><div class="footer-body"><img src="/img/apiboot-gray.png"/><div class="cols-container"><div class="col col-12"><h3>愿景</h3><p>ApiBoot致力于解决快速开发接口服务、集成第三方依赖</p></div><div class="col col-6"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/introduce.html" target="_self">概览</a></dd><dd><a href="/zh-cn/docs/quick-start.html" target="_self">快速开始</a></dd><dd><a href="/zh-cn/docs/faq.html" target="_self">开发者指南</a></dd></dl></div><div class="col col-6"><dl><dt>资源</dt><dd><a href="https://blog.yuqiyu.com" target="_self">作者博客</a></dd><dd><a href="https://blog.yuqiyu.com/apiboot-all-articles.html" target="_self">文章专题</a></dd></dl></div></div><div class="copyright"><span>Copyright © 2019 恒宇少年 - 于起宇</span></div></div></footer></div></div>
  <script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
  <script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
  <script>
    window.rootPath = '';
  </script>
  <script src="/build/documentation.js"></script>
</body>

</html>