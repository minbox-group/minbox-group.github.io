<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="api-boot-oss" />
	<meta name="description" content="api-boot-oss" />
	<!-- 网页标签标题 -->
	<title>ApiBoot Oss 使用文档</title>
	<link rel="shortcut icon" href="/img/favicon.ico" />
	<link rel="stylesheet" href="/build/documentation.css" />
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-149679255-1"></script>
	<script>
  		window.dataLayer = window.dataLayer || [];
  		function gtag(){dataLayer.push(arguments);}
  		gtag('js', new Date());
  		gtag('config', 'UA-149679255-1');
	</script>
</head>

<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="/img/apiboot-colorful.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">En</span><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="/zh-cn/index.html" target="_self">首页</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a href="/zh-cn/docs/quick-start.html" target="_self">文档</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>ApiBoot 文档</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>ApiBoot</span><ul><li style="height:144px;overflow:hidden" class="menu-item menu-item-level-2"><span>ApiBoot是什么？<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/introduce.html" target="_self">ApiBoot简介</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/faq.html" target="_self">FAQ</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/update-log.html" target="_self">更新日志</a></li></ul></li><li style="height:216px;overflow:hidden" class="menu-item menu-item-level-2"><span>ApiBoot往期版本文档<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/history-reference-guide.html" target="_self">往期文档说明</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.1.3.RELEASE/reference-guide.html" target="_self">2.1.3.RELEASE</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.1.2.RELEASE/reference-guide.html" target="_self">2.1.2.RELEASE</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.1.1.RELEASE/reference-guide.html" target="_self">2.1.1.RELEASE</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.1.0.RELEASE/reference-guide.html" target="_self">2.1.0.RELEASE</a></li></ul></li><li style="height:756px;overflow:hidden" class="menu-item menu-item-level-2"><span>快速开始<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/quick-start.html" target="_self">第一个ApiBoot应用程序</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/version-rely.html" target="_self">版本依赖</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-logging-admin-ui.html" target="_self">ApiBoot Logging Admin UI</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-logging-admin.html" target="_self">ApiBoot Logging Admin</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-logging.html" target="_self">ApiBoot Logging</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-security.html" target="_self">ApiBoot Security</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-oauth.html" target="_self">ApiBoot OAuth</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-swagger.html" target="_self">ApiBoot Swagger</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-quartz.html" target="_self">ApiBoot Quartz</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-rate-limiter.html" target="_self">ApiBoot RateLimiter</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-datasource-switch.html" target="_self">ApiBoot DataSource Switch</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-mybatis-enhance.html" target="_self">ApiBoot Mybatis Enhance</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-mybatis-enhance-codegen.html" target="_self">ApiBoot Mybatis Enhance Codegen</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-mybatis-pageable.html" target="_self">ApiBoot Mybatis Pageable</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-resource-load.html" target="_self">ApiBoot Resource Load</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-message-push.html" target="_self">ApiBoot Message Push</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-http-message-converter.html" target="_self">ApiBoot HttpMessage Converter</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-oss.html" target="_self">ApiBoot AliYun OSS</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-mail.html" target="_self">ApiBoot AliYun Mail</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-sms.html" target="_self">ApiBoot AliYun SMS</a></li></ul></li><li style="height:144px;overflow:hidden" class="menu-item menu-item-level-2"><span>运维指南<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/deploy.html" target="_self">打包部署</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/domain.html" target="_self">域名解析</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/nginx-load-balance.html" target="_self">Nginx负载均衡</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>开源共建<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/contribution.html" target="_self">贡献源码</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/conventions.html" target="_self">编码约定</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/new-starter.html" target="_self">新建组件</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-plan.html" target="_self">ApiBoot规划</a></li></ul></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>ApiBoot 整合 阿里云对象存储OSS</h1>
<p><code>ApiBoot</code>添加快速集成<code>Aliyun</code>的对象存储服务<code>Oss</code>，提供常用的文件操作方法，当然也提供自定义扩展，以致于满足绝大数业务场景，并且通过扩展可以实现上传文件进度条、下载文件进度条、存储空间操作、静态网站托管、访问日志、防盗链、分片上传、追加上传、断点续传等等。</p>
<h2>引入ApiBoot Alibaba Oss</h2>
<p>在<code>pom.xml</code>配置文件内添加依赖，如下所示：</p>
<pre><code class="language-xml"><span class="hljs-comment">&lt;!--ApiBoot Alibaba Oss--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.minbox.framework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>api-boot-starter-alibaba-oss<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<blockquote>
<p>注意：如果未添加<code>ApiBoot</code>版本依赖，请访问<a href="/zh-cn/docs/version-rely.html">版本依赖</a>查看添加方式。</p>
</blockquote>
<h2>配置参数列表</h2>
<table>
<thead>
<tr>
<th>配置参数</th>
<th>参数介绍</th>
<th>默认值</th>
<th>是否必填</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>api.boot.oss.region</code></td>
<td>oss所属地域</td>
<td>空</td>
<td>是</td>
</tr>
<tr>
<td><code>api.boot.oss.bucket-name</code></td>
<td>oss存储空间名称</td>
<td>空</td>
<td>是</td>
</tr>
<tr>
<td><code>api.boot.oss.access-key-id</code></td>
<td>阿里云账户accessKeyId</td>
<td>空</td>
<td>是</td>
</tr>
<tr>
<td><code>api.boot.oss.access-key-secret</code></td>
<td>阿里云账户accessKeySecret</td>
<td>空</td>
<td>是</td>
</tr>
<tr>
<td><code>api.boot.oss.domain</code></td>
<td>oss存储空间所绑定的自定义域名，如果不配置，上传文件成功后返回默认格式化的文件访问路径</td>
<td>空</td>
<td>否</td>
</tr>
</tbody>
</table>
<h2>上传文件</h2>
<p>在使用<code>ApiBoot Oss</code>时，只需要注入<code>ApiBootOssService</code>类就可以完成默认方法的使用，如下所示：</p>
<pre><code class="language-java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> ApiBootOssService apiBootOssService;
</code></pre>
<h3>流上传</h3>
<pre><code class="language-java"><span class="hljs-comment">/**
  * 流方式上传
  */</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">uploadBytes</span><span class="hljs-params">()</span> </span>{
  ApiBootObjectStorageResponse response = apiBootOssService.upload(<span class="hljs-string">"admin.txt"</span>, <span class="hljs-string">"admin"</span>.getBytes());
  logger.info(<span class="hljs-string">"文件名称：{}"</span>, response.getObjectName());
  logger.info(<span class="hljs-string">"文件访问路径：{}"</span>, response.getObjectUrl());
}
</code></pre>
<h3>本地文件上传</h3>
<pre><code class="language-java"><span class="hljs-comment">/**
* 本地文件上传
*/</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">uploadFile</span><span class="hljs-params">()</span> </span>{
	ApiBootObjectStorageResponse response = apiBootOssService.upload(<span class="hljs-string">"logo.png"</span>, <span class="hljs-string">"/Users/yuqiyu/Downloads/logo.png"</span>);
	logger.info(<span class="hljs-string">"文件名称：{}"</span>, response.getObjectName());
	logger.info(<span class="hljs-string">"文件访问路径：{}"</span>, response.getObjectUrl());
}
</code></pre>
<h3>文件流上传</h3>
<pre><code class="language-java"><span class="hljs-comment">/**
* 文件流方式上传
*
* <span class="hljs-doctag">@throws</span> Exception
*/</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">uploadInputStream</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{
	FileInputStream inputStream = <span class="hljs-keyword">new</span> FileInputStream(<span class="hljs-keyword">new</span> File(<span class="hljs-string">"/Users/yuqiyu/Downloads/logo.png"</span>));
	ApiBootObjectStorageResponse response = apiBootOssService.upload(<span class="hljs-string">"测试.png"</span>, inputStream);
	logger.info(<span class="hljs-string">"文件名称：{}"</span>, response.getObjectName());
	logger.info(<span class="hljs-string">"文件访问路径：{}"</span>, response.getObjectUrl());
}
</code></pre>
<blockquote>
<p>通过文件的输入流完成对象存储文件的上传</p>
</blockquote>
<h3>下载文件</h3>
<pre><code class="language-java"><span class="hljs-comment">/**
  * 下载文件
  */</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">download</span><span class="hljs-params">()</span> </span>{
  apiBootOssOverrideService.download(<span class="hljs-string">"测试.png"</span>, <span class="hljs-string">"/Users/yuqiyu/Downloads/测试.png"</span>);
}
</code></pre>
<blockquote>
<p>在上面的示例中，文件会自动下载到<code>/Users/yuqiyu/Downloads/</code>目录下，文件名称为<code>测试.png</code>。</p>
</blockquote>
<h3>删除文件</h3>
<pre><code class="language-java"><span class="hljs-comment">/**
* 删除文件示例
*/</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">()</span> </span>{
	apiBootOssOverrideService.delete(<span class="hljs-string">"测试.png"</span>);
}
</code></pre>
<blockquote>
<p>删除对象存储空间内的文件时只需要传递文件名即可。</p>
</blockquote>
<h3>MultipartFile 上传文件</h3>
<p>如果你是通过<code>SpringMvc</code>提供的<code>MultipartFile</code>对象进行上传文件，可以通过如下示例进行上传：</p>
<pre><code class="language-java">MultipartFile multipartFile = ..;
<span class="hljs-comment">// 流方式上传</span>
ApiBootObjectStorageResponse responseByte = apiBootOssService.upload(<span class="hljs-string">"测试.png"</span>, multipartFile.getBytes());
<span class="hljs-comment">// 文件输入流方式上传</span>
ApiBootObjectStorageResponse responseIs = apiBootOssService.upload(<span class="hljs-string">"测试.png"</span>, multipartFile.getInputStream());
</code></pre>
<h2>分片上传</h2>
<p><code>ApiBoot</code>集成了分片上传，只需要一个方法就可以把大文件进行分片上传，<code>ApiBoot</code>会自动根据<code>partSize</code>进行整理分片数量，如下所示：</p>
<pre><code class="language-java">ApiBootObjectStorageResponse response = apiBootOssService
                .multipartUpload(
  <span class="hljs-string">"初识ApiBoot.mp4"</span>,
  <span class="hljs-comment">//路径方式："/Users/yuqiyu/Downloads/fa2a664e-f827-cfab-7323-3583b3ffd00c.mp4",</span>
  <span class="hljs-comment">// 文件对象方式</span>
  <span class="hljs-keyword">new</span> File(<span class="hljs-string">"/Users/yuqiyu/Downloads/fa2a664e-f827-cfab-7323-3583b3ffd00c.mp4"</span>),
  PartSize.MB);
System.out.println(<span class="hljs-string">"文件名称："</span> + response.getObjectName());
System.out.println(<span class="hljs-string">"文件路径："</span> + response.getObjectUrl());
</code></pre>
<p>方法参数描述：</p>
<ol>
<li>文件名称</li>
<li>本地文件路径</li>
<li>每一个<code>part</code>的大小，可以直接使用<code>ApiBoot</code>提供的<code>PartSize</code>接口常量来进行计算。</li>
</ol>
<h2>自定义扩展</h2>
<p><code>ApiBoot Alibaba Oss</code>提供的方法毕竟是有限的，因此<code>ApiBoot</code>提供了自定义的扩展方式，让使用者可以根据<code>Oss</code>官方文档进行扩展，包含上传文件进度条、下载文件进度条、存储空间操作、静态网站托管、访问日志、防盗链、分片上传、追加上传、断点续传等等。</p>
<p>自定义扩展首先需要创建类并继承<code>ApiBootOssService</code>，如下所示：</p>
<pre><code class="language-java"><span class="hljs-comment">//...</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiBootOssOverrideService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ApiBootOssService</span> </span>{
    <span class="hljs-comment">/**
     * logger instance
     */</span>
    <span class="hljs-keyword">static</span> Logger logger = LoggerFactory.getLogger(ApiBootOssOverrideService.class);

    <span class="hljs-comment">/**
     * 实现父类构造函数
     *
     * <span class="hljs-doctag">@param</span> endpoint        外网节点
     * <span class="hljs-doctag">@param</span> bucketName      存储空间名称
     * <span class="hljs-doctag">@param</span> accessKeyId     阿里云账号授权Id
     * <span class="hljs-doctag">@param</span> accessKeySecret 阿里云账号授权Secret
     * <span class="hljs-doctag">@param</span> domain          自定义域名
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ApiBootOssOverrideService</span><span class="hljs-params">(String endpoint, String bucketName, String accessKeyId, String accessKeySecret, String domain)</span> </span>{
        <span class="hljs-keyword">super</span>(endpoint, bucketName, accessKeyId, accessKeySecret, domain);
    }

    <span class="hljs-comment">/**
     * 创建bucket存储
     *
     * <span class="hljs-doctag">@param</span> bucketName 存储名称
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createBucket</span><span class="hljs-params">(String bucketName)</span> </span>{
        OSSClient ossClient = getOssClient();
        Bucket bucket = ossClient.createBucket(bucketName);
        logger.info(<span class="hljs-string">"新创建存储空间名称：{}"</span>, bucket.getName());
        logger.info(<span class="hljs-string">"新创建存储空间所属人：{}"</span>, bucket.getOwner().getDisplayName());
        closeOssClient(ossClient);
    }
}
</code></pre>
<p>如上<code>createBucket</code>方法所示<code>ApiBootOssService</code>内部提供了获取<code>OssClient</code>以及关闭<code>OssClient</code>连接的方法，可以直接调用。</p>
<p><strong>扩展生效</strong></p>
<p>我们自定义的扩展，需要将实例放入<code>SpringIOC</code>容器内，方便我们在使用处进行注入，要注意，由于构造函数参数的原因，无法直接通过<code>@Service</code>或者<code>@Component</code>注解进行标注，需要通过如下方式：</p>
<pre><code class="language-java"><span class="hljs-comment">//...</span>
<span class="hljs-meta">@Bean</span>
<span class="hljs-meta">@ConditionalOnMissingBean</span>
<span class="hljs-function">ApiBootOssOverrideService <span class="hljs-title">apiBootOssOverrideService</span><span class="hljs-params">(ApiBootOssProperties apiBootOssProperties)</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ApiBootOssOverrideService(apiBootOssProperties.getRegion().getEndpoint(), apiBootOssProperties.getBucketName(), apiBootOssProperties.getAccessKeyId(), apiBootOssProperties.getAccessKeySecret(), apiBootOssProperties.getDomain());
}
</code></pre>
<p><code>ApiBootOssProperties</code>属性配置类，是<code>ApiBoot</code>内置的，可以在任意地方进行注入，这里目的只是为了拿到相关配置进行构造参数实例化使用。</p>
</div></section><footer class="footer-container"><div class="footer-body"><img src="/img/apiboot-gray.png"/><div class="cols-container"><div class="col col-12"><h3>愿景</h3><p>ApiBoot致力于解决快速开发接口服务、集成第三方依赖</p></div><div class="col col-6"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/introduce.html" target="_self">概览</a></dd><dd><a href="/zh-cn/docs/quick-start.html" target="_self">快速开始</a></dd><dd><a href="/zh-cn/docs/faq.html" target="_self">开发者指南</a></dd></dl></div><div class="col col-6"><dl><dt>资源</dt><dd><a href="/zh-cn/blog/index.html" target="_self">博客</a></dd><dd><a href="/zh-cn/community/index.html" target="_self">社区</a></dd></dl></div></div><div class="copyright"><span>Copyright © 2019 恒宇少年 - 于起宇</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
	</script>
	<script src="/build/documentation.js"></script>
</body>

</html>