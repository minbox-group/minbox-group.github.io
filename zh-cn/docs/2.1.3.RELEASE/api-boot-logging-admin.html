<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="keywords" content="api-boot-logging-admin" />
  <meta name="description" content="api-boot-logging-admin" />
  <!-- 网页标签标题 -->
  <title>ApiBoot Logging Admin 使用文档</title>
  <link rel="shortcut icon" href="/img/favicon.ico" />
  <link rel="stylesheet" href="/build/documentation.css" />
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-149679255-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-149679255-1');
  </script>
</head>

<body>
  <div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="/img/apiboot-colorful.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">En</span><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="/zh-cn/index.html" target="_self">首页</a></li><li class="menu-item menu-item-normal"><a href="https://gitee.com/minbox-projects/api-boot-admin" target="_self">ApiBoot + Vue = Admin</a></li><li class="menu-item menu-item-normal"><a href="https://blog.yuqiyu.com" target="_self">作者博客</a></li><li class="menu-item menu-item-normal"><a href="https://blog.yuqiyu.com/apiboot-all-articles.html" target="_self">组件使用文章</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a href="/zh-cn/docs/quick-start.html" target="_self">文档</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>ApiBoot 文档</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>ApiBoot</span><ul><li style="height:144px;overflow:hidden" class="menu-item menu-item-level-2"><span>ApiBoot是什么？<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/introduce.html" target="_self">ApiBoot简介</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/faq.html" target="_self">FAQ</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/update-log.html" target="_self">更新日志</a></li></ul></li><li style="height:288px;overflow:hidden" class="menu-item menu-item-level-2"><span>ApiBoot往期版本文档<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/history-reference-guide.html" target="_self">往期文档说明</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.1.5.RELEASE/reference-guide.html" target="_self">2.1.5.RELEASE</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.1.4.RELEASE/reference-guide.html" target="_self">2.1.4.RELEASE</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.1.3.RELEASE/reference-guide.html" target="_self">2.1.3.RELEASE</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.1.2.RELEASE/reference-guide.html" target="_self">2.1.2.RELEASE</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.1.1.RELEASE/reference-guide.html" target="_self">2.1.1.RELEASE</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.1.0.RELEASE/reference-guide.html" target="_self">2.1.0.RELEASE</a></li></ul></li><li style="height:756px;overflow:hidden" class="menu-item menu-item-level-2"><span>快速开始<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/quick-start.html" target="_self">第一个ApiBoot应用程序</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/version-rely.html" target="_self">版本依赖</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-logging-admin-ui.html" target="_self">ApiBoot Logging Admin UI</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-logging-admin.html" target="_self">ApiBoot Logging Admin</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-logging.html" target="_self">ApiBoot Logging</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-security.html" target="_self">ApiBoot Security</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-oauth.html" target="_self">ApiBoot OAuth</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-swagger.html" target="_self">ApiBoot Swagger</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-quartz.html" target="_self">ApiBoot Quartz</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-rate-limiter.html" target="_self">ApiBoot RateLimiter</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-datasource-switch.html" target="_self">ApiBoot DataSource Switch</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-mybatis-enhance.html" target="_self">ApiBoot Mybatis Enhance</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-mybatis-enhance-codegen.html" target="_self">ApiBoot Mybatis Enhance Codegen</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-mybatis-pageable.html" target="_self">ApiBoot Mybatis Pageable</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-resource-load.html" target="_self">ApiBoot Resource Load</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-message-push.html" target="_self">ApiBoot Message Push</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-http-message-converter.html" target="_self">ApiBoot HttpMessage Converter</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-oss.html" target="_self">ApiBoot AliYun OSS</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-mail.html" target="_self">ApiBoot AliYun Mail</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-sms.html" target="_self">ApiBoot AliYun SMS</a></li></ul></li><li style="height:144px;overflow:hidden" class="menu-item menu-item-level-2"><span>运维指南<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/deploy.html" target="_self">打包部署</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/domain.html" target="_self">域名解析</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/nginx-load-balance.html" target="_self">Nginx负载均衡</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>开源共建<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/contribution.html" target="_self">贡献源码</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/conventions.html" target="_self">编码约定</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/new-starter.html" target="_self">新建组件</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-plan.html" target="_self">ApiBoot规划</a></li></ul></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>链路日志Admin管理端点</h1>
<p><code>ApiBoot Logging Admin</code>是<code>ApiBoot Logging</code>组件的管理端，用于接收<code>ApiBoot Logging</code>上报的请求日志信息并且将日志信息<code>存储到数据库</code>，针对日志做一些分析、阈值告警通知等。</p>
<blockquote>
<p>可以根据<code>TraceID</code>、<code>SpanID</code>针对一条链路的日志分析。</p>
</blockquote>
<h2>部署方式</h2>
<p><code>ApiBoot Logging Admin</code>应该独立于<code>业务服务</code>部署，因为请求日志的数量会较大，会耗费较大的<code>内存</code>以及<code>CPU计算能力</code>。</p>
<h2>1. 添加依赖组件</h2>
<p>添加<code>ApiBoot Logging Admin</code>依赖到<code>pom.xml</code>，如下所示：</p>
<pre><code class="language-xml"><span class="hljs-comment">&lt;!--ApiBoot Logging Admin--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.minbox.framework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>api-boot-starter-logging-admin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3>内部封装的组件</h3>
<p><code>ApiBoot</code>从<code>2.1.3.RELEASE</code>版本开始陆续会将<code>api-boot-plugins</code>模块下的组件从<code>api-boot</code>项目分离到<code>minbox-projects</code>开源组织内作为独立的项目进行升级维护，<code>ApiBoot Logging</code>内部通过封装<code>minbox-projects/minbox-logging</code>组件的<code>minbox-logging-admin</code>实现。</p>
<blockquote>
<p><code>minbox-logging</code>源码地址：<a href="https://gitee.com/minbox-projects/minbox-logging">https://gitee.com/minbox-projects/minbox-logging</a></p>
</blockquote>
<h2>2. 初始化数据库</h2>
<p>如果<code>ApiBoot Logging Admin</code>所处的项目内存在<code>DataSource</code>对象，会自动启用<code>JDBC</code>方式将各个<code>ApiBoot Logging</code>上报的请求日志保存到数据库指定表内。</p>
<h3>2.1 ApiBoot Logging Admin 所需建表语句</h3>
<p>表结构如下所示：</p>
<pre><code class="language-sql"> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">NAMES</span> utf8mb4 ;

<span class="hljs-comment">--</span>
<span class="hljs-comment">-- Table structure for table `logging_request_logs`</span>
<span class="hljs-comment">--</span>

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`logging_request_logs`</span> (
  <span class="hljs-string">`lrl_id`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">36</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_general_ci <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'主键，UUID'</span>,
  <span class="hljs-string">`lrl_service_detail_id`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">36</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_general_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'服务详情编号，关联logging_service_details主键'</span>,
  <span class="hljs-string">`lrl_trace_id`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">36</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_general_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'链路ID'</span>,
  <span class="hljs-string">`lrl_parent_span_id`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">36</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_general_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'上级跨度ID'</span>,
  <span class="hljs-string">`lrl_span_id`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">36</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_general_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'跨度ID'</span>,
  <span class="hljs-string">`lrl_start_time`</span> mediumtext <span class="hljs-keyword">COLLATE</span> utf8mb4_general_ci <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'请求开始时间'</span>,
  <span class="hljs-string">`lrl_end_time`</span> mediumtext <span class="hljs-keyword">COLLATE</span> utf8mb4_general_ci <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'请求结束时间'</span>,
  <span class="hljs-string">`lrl_http_status`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'请求响应状态码'</span>,
  <span class="hljs-string">`lrl_request_body`</span> longtext <span class="hljs-keyword">COLLATE</span> utf8mb4_general_ci <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'请求主体内容'</span>,
  <span class="hljs-string">`lrl_request_headers`</span> <span class="hljs-built_in">text</span> <span class="hljs-keyword">COLLATE</span> utf8mb4_general_ci <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'请求头信息'</span>,
  <span class="hljs-string">`lrl_request_ip`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_general_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'发起请求客户端的IP地址'</span>,
  <span class="hljs-string">`lrl_request_method`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_general_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'请求方式'</span>,
  <span class="hljs-string">`lrl_request_uri`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_general_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'请求路径'</span>,
  <span class="hljs-string">`lrl_response_body`</span> longtext <span class="hljs-keyword">COLLATE</span> utf8mb4_general_ci <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'响应内容'</span>,
  <span class="hljs-string">`lrl_response_headers`</span> <span class="hljs-built_in">text</span> <span class="hljs-keyword">COLLATE</span> utf8mb4_general_ci <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'响应头信息'</span>,
  <span class="hljs-string">`lrl_time_consuming`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'请求耗时'</span>,
  <span class="hljs-string">`lrl_create_time`</span> <span class="hljs-built_in">timestamp</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'日志保存时间'</span>,
  <span class="hljs-string">`lrl_request_params`</span> <span class="hljs-built_in">text</span> <span class="hljs-keyword">COLLATE</span> utf8mb4_general_ci,
  <span class="hljs-string">`lrl_exception_stack`</span> <span class="hljs-built_in">text</span> <span class="hljs-keyword">COLLATE</span> utf8mb4_general_ci,
  PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`lrl_id`</span>),
  <span class="hljs-keyword">KEY</span> <span class="hljs-string">`logging_request_logs_LRL_SERVICE_DETAIL_ID_index`</span> (<span class="hljs-string">`lrl_service_detail_id`</span>)
) <span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CHARSET</span>=utf8mb4 <span class="hljs-keyword">COLLATE</span>=utf8mb4_general_ci <span class="hljs-keyword">COMMENT</span>=<span class="hljs-string">'请求日志信息表'</span>;

<span class="hljs-comment">--</span>
<span class="hljs-comment">-- Table structure for table `logging_service_details`</span>
<span class="hljs-comment">--</span>

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`logging_service_details`</span> (
  <span class="hljs-string">`lsd_id`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">36</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_general_ci <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">`lsd_service_id`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_general_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'上报服务的ID，对应spring.application.name配置值'</span>,
  <span class="hljs-string">`lsd_service_ip`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_general_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'上报服务的IP地址'</span>,
  <span class="hljs-string">`lsd_service_port`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'上报服务的端口号'</span>,
  <span class="hljs-string">`lsd_last_report_time`</span> <span class="hljs-built_in">timestamp</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'最后一次上报时间，每次上报更新'</span>,
  <span class="hljs-string">`lsd_create_time`</span> <span class="hljs-built_in">timestamp</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'首次上报时创建时间'</span>,
  PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`lsd_id`</span>)
) <span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CHARSET</span>=utf8mb4 <span class="hljs-keyword">COLLATE</span>=utf8mb4_general_ci <span class="hljs-keyword">COMMENT</span>=<span class="hljs-string">'上报日志的客户端服务详情'</span>;

</code></pre>
<blockquote>
<p><code>ApiBoot Logging Admin</code>提供了固定的表结构，如果你的<code>ApiBoot Logging Admin</code>是独立于<code>业务服务</code>部署的可以创建一个<code>单独的数据库</code>来保存请求日志</p>
</blockquote>
<h3>2.2 添加数据库依赖</h3>
<p>添加对应的<code>数据库驱动</code>、<code>数据源</code>、<code>ORM</code>框架以依赖来初始化<code>DataSource</code>，下面以<code>MySQL</code>驱动示例，如下所示：</p>
<pre><code class="language-xml"><span class="hljs-comment">&lt;!--ApiBoot Mybatis Enhance--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.minbox.framework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>api-boot-starter-mybatis-enhance<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-comment">&lt;!--MySQL驱动--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-comment">&lt;!--Hikari数据源--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.zaxxer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>HikariCP<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3>2.3 配置数据源</h3>
<p>在<code>application.yml</code>配置文件内添加数据库配置信息，如下所示：</p>
<pre><code class="language-yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-comment"># 数据源配置</span>
<span class="hljs-attr">  datasource:</span>
<span class="hljs-attr">    url:</span> <span class="hljs-attr">jdbc:mysql://localhost:3306/test</span>
<span class="hljs-attr">    driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
<span class="hljs-attr">    type:</span> <span class="hljs-string">com.zaxxer.hikari.HikariDataSource</span>
<span class="hljs-attr">    username:</span> <span class="hljs-string">root</span>
<span class="hljs-attr">    password:</span> <span class="hljs-number">123456</span>
</code></pre>
<h2>3. 安全配置</h2>
<p>由于日志分析的严谨性，不允许匿名上报，因为<code>ApiBoot Logging Admin</code>整合<code>Spring Security</code>完成<code>Basic</code>基本认证，只有<code>ApiBoot Logging</code>组件上报日志时，携带<code>Admin</code>配置的<code>Spring Security</code>用户名、密码才能将日志完成存储。</p>
<h3>3.1 添加Spring Security依赖</h3>
<p>添加<code>springboot security</code>依赖到<code>pom.xml</code>，如下所示：</p>
<pre><code class="language-xml"><span class="hljs-comment">&lt;!--Spring Boot Security--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3>3.2 配置用户</h3>
<p><code>Spring Boot Security</code>提供了<code>application.yml</code>配置文件内配置<code>内存用户</code>，配置方式如下所示：</p>
<pre><code class="language-yaml"><span class="hljs-attr">spring:</span>
<span class="hljs-attr">  security:</span>
<span class="hljs-attr">    user:</span>
      <span class="hljs-comment"># 用户名</span>
<span class="hljs-attr">      name:</span> <span class="hljs-string">user</span>
      <span class="hljs-comment"># 密码 </span>
<span class="hljs-attr">      password:</span> <span class="hljs-number">123456</span>
</code></pre>
<blockquote>
<p>从<strong>2.1.3.RELEASE</strong>版本开始，不再需要自行实现<code>WebSecurityConfigurerAdapter</code>自行去配置安全参数，<code>ApiBoot Logging Admin</code>通过<code>ApiBootLoggingAdminSecurityAutoConfiguration</code>自动化配置类添加了基础安全配置。</p>
</blockquote>
<h2>4. 注册到SpringCloud服务注册中心</h2>
<p><code>ApiBoot Logging Admin</code>支持标准的<code>Spring Cloud Discovery</code>的服务注册中心配置，比如：<code>Eureka</code>、<code>Consul</code>、<code>Nacos</code>等。</p>
<h3>4.1 添加依赖</h3>
<p>添加依赖到<code>pom.xml</code>，下面是使用<code>Eureka</code>的依赖方式：</p>
<pre><code class="language-xml"><span class="hljs-comment">&lt;!--Erueka Client--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3>4.2 配置注册中心地址</h3>
<p>在<code>application.yml</code>配置文件内添加<code>Eureka Server</code>的地址信息，如下所示：</p>
<pre><code class="language-yaml"><span class="hljs-comment"># Eureka Config</span>
<span class="hljs-attr">eureka:</span>
<span class="hljs-attr">  client:</span>
<span class="hljs-attr">    service-url:</span>
<span class="hljs-attr">      defaultZone:</span> <span class="hljs-attr">http://service:nodev2@127.0.0.1:9090/eureka/</span>
<span class="hljs-attr">  instance:</span>
    <span class="hljs-comment"># IP首选方式注册服务</span>
<span class="hljs-attr">    prefer-ip-address:</span> <span class="hljs-literal">true</span>
</code></pre>
<blockquote>
<p>注意：这里一定开启<code>IP首选</code>的方式进行服务注册，因为<code>SpringCloud Eureka Client</code>默认使用<code>主机名</code>的方式进行注册服务，而<code>ApiBoot Logging</code>在服务发现时如果通过主机名可能无法访问到<code>ApiBoot Logging Admin</code>服务的上报请求日志端点。</p>
</blockquote>
<h2>5. 链路分析</h2>
<p>在一条链路下<code>TraceID</code>是相同的，而链路内的每一个请求单元都会对应生成一个<code>SpanID</code>，如果存在多级嵌套服务访问，可以根据<code>Parent SpanID</code>进行分析。</p>
<h2>6. 控制台打印上报日志</h2>
<pre><code class="language-yaml"><span class="hljs-attr">api:</span>
<span class="hljs-attr">  boot:</span>
<span class="hljs-attr">    logging:</span>
<span class="hljs-attr">      admin:</span>
        <span class="hljs-comment"># 显示上报日志</span>
<span class="hljs-attr">        show-console-report-log:</span> <span class="hljs-literal">true</span>
</code></pre>
<h2>7. 美化控制台打印上报日志</h2>
<pre><code class="language-yaml"><span class="hljs-attr">api:</span>
<span class="hljs-attr">  boot:</span>
<span class="hljs-attr">    logging:</span>
<span class="hljs-attr">      admin:</span>
        <span class="hljs-comment"># 显示上报日志</span>
<span class="hljs-attr">        show-console-report-log:</span> <span class="hljs-literal">true</span>
        <span class="hljs-comment"># 格式化上报日志</span>
<span class="hljs-attr">        format-console-log-json:</span> <span class="hljs-literal">true</span>
</code></pre>
<h2>8. 控制台打印的日志</h2>
<p>控制台打印日志如下所示：</p>
<pre><code class="language-sh">2019-07-25 10:38:55.835  INFO 4196 --- [nio-9090-exec-1] .a.b.p.l.a.l.ReportLogJsonFormatListener : Receiving Service: 【api-boot-sample-logging -&gt; 192.168.1.33】, Request Log Report，Logging Content：[
	{
		<span class="hljs-string">"endTime"</span>:1564022335085,
		<span class="hljs-string">"httpStatus"</span>:200,
		<span class="hljs-string">"requestBody"</span>:<span class="hljs-string">"{\n\t\"name\":\"测试\",\n\t\"email\":\"jnyuqy@gmail.com\"\n}"</span>,
		<span class="hljs-string">"requestHeaders"</span>:{
			<span class="hljs-string">"content-length"</span>:<span class="hljs-string">"52"</span>,
			<span class="hljs-string">"cookie"</span>:<span class="hljs-string">"JSESSIONID=8E206A652D76A5DF1775FC8988549DF4"</span>,
			<span class="hljs-string">"postman-token"</span>:<span class="hljs-string">"2e0e9c0d-a2d2-46fb-ab60-85abeb6df92d"</span>,
			<span class="hljs-string">"host"</span>:<span class="hljs-string">"localhost:8080"</span>,
			<span class="hljs-string">"content-type"</span>:<span class="hljs-string">"application/json"</span>,
			<span class="hljs-string">"connection"</span>:<span class="hljs-string">"keep-alive"</span>,
			<span class="hljs-string">"cache-control"</span>:<span class="hljs-string">"no-cache"</span>,
			<span class="hljs-string">"accept-encoding"</span>:<span class="hljs-string">"gzip, deflate"</span>,
			<span class="hljs-string">"user-agent"</span>:<span class="hljs-string">"PostmanRuntime/7.15.2"</span>,
			<span class="hljs-string">"accept"</span>:<span class="hljs-string">"*/*"</span>
		},
		<span class="hljs-string">"requestIp"</span>:<span class="hljs-string">"0:0:0:0:0:0:0:1"</span>,
		<span class="hljs-string">"requestMethod"</span>:<span class="hljs-string">"POST"</span>,
		<span class="hljs-string">"requestUri"</span>:<span class="hljs-string">"/index"</span>,
		<span class="hljs-string">"responseBody"</span>:<span class="hljs-string">"测试"</span>,
		<span class="hljs-string">"responseHeaders"</span>:{},
		<span class="hljs-string">"serviceId"</span>:<span class="hljs-string">"api-boot-sample-logging"</span>,
		<span class="hljs-string">"serviceIp"</span>:<span class="hljs-string">"192.168.1.33"</span>,
		<span class="hljs-string">"servicePort"</span>:<span class="hljs-string">"8080"</span>,
		<span class="hljs-string">"spanId"</span>:<span class="hljs-string">"263c8f38-855d-40c4-9ddd-502fb9401eed"</span>,
		<span class="hljs-string">"startTime"</span>:1564022334986,
		<span class="hljs-string">"timeConsuming"</span>:99,
		<span class="hljs-string">"traceId"</span>:<span class="hljs-string">"791d84c0-c0e2-4141-a164-75d219fa4271"</span>
	}
]
2019-07-25 10:38:55.836 DEBUG 4196 --- [nio-9090-exec-1] m.f.a.b.p.l.a.l.ReportLogStorageListener : Starting Storage Report Request Logs.
2019-07-25 10:38:55.836  INFO 4196 --- [nio-9090-exec-1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2019-07-25 10:38:56.282  INFO 4196 --- [nio-9090-exec-1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2019-07-25 10:38:56.401 DEBUG 4196 --- [nio-9090-exec-1] m.f.a.b.p.l.a.l.ReportLogStorageListener : Storage Report Request Logs Complete.
</code></pre>
</div></section><footer class="footer-container"><div class="footer-body"><img src="/img/apiboot-gray.png"/><div class="cols-container"><div class="col col-12"><h3>愿景</h3><p>ApiBoot致力于解决快速开发接口服务、集成第三方依赖</p></div><div class="col col-6"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/introduce.html" target="_self">概览</a></dd><dd><a href="/zh-cn/docs/quick-start.html" target="_self">快速开始</a></dd><dd><a href="/zh-cn/docs/faq.html" target="_self">开发者指南</a></dd></dl></div><div class="col col-6"><dl><dt>资源</dt><dd><a href="https://blog.yuqiyu.com" target="_self">作者博客</a></dd><dd><a href="https://blog.yuqiyu.com/apiboot-all-articles.html" target="_self">文章专题</a></dd></dl></div></div><div class="copyright"><span>Copyright © 2019 恒宇少年 - 于起宇</span></div></div></footer></div></div>
  <script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
  <script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
  <script>
    window.rootPath = '';
  </script>
  <script src="/build/documentation.js"></script>
</body>

</html>