<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="api-boot-message-push" />
	<meta name="description" content="api-boot-message-push" />
	<!-- 网页标签标题 -->
	<title>ApiBoot Message Push 使用文档</title>
	<link rel="shortcut icon" href="/img/favicon.ico" />
	<link rel="stylesheet" href="/build/documentation.css" />
</head>

<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="/img/apiboot-colorful.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">En</span><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="/zh-cn/index.html" target="_self">首页</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a href="/zh-cn/docs/quick-start.html" target="_self">文档</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>ApiBoot 文档</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>ApiBoot</span><ul><li style="height:144px;overflow:hidden" class="menu-item menu-item-level-2"><span>ApiBoot是什么？<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/introduce.html" target="_self">ApiBoot简介</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/faq.html" target="_self">FAQ</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/update-log.html" target="_self">更新日志</a></li></ul></li><li style="height:648px;overflow:hidden" class="menu-item menu-item-level-2"><span>快速开始<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/quick-start.html" target="_self">第一个ApiBoot应用程序</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/version-rely.html" target="_self">版本依赖</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-security.html" target="_self">ApiBoot Security</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-oauth.html" target="_self">ApiBoot OAuth</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-swagger.html" target="_self">ApiBoot Swagger</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-quartz.html" target="_self">ApiBoot Quartz</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-rate-limiter.html" target="_self">ApiBoot RateLimiter</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-datasource-switch.html" target="_self">ApiBoot DataSource Switch</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-mybatis-enhance.html" target="_self">ApiBoot Mybatis Enhance</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-mybatis-enhance-codegen.html" target="_self">ApiBoot Mybatis Enhance Codegen</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-mybatis-pageable.html" target="_self">ApiBoot Mybatis Pageable</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-resource-load.html" target="_self">ApiBoot Resource Load</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-message-push.html" target="_self">ApiBoot Message Push</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-http-message-converter.html" target="_self">ApiBoot HttpMessage Converter</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-oss.html" target="_self">ApiBoot AliYun OSS</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-mail.html" target="_self">ApiBoot AliYun Mail</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-sms.html" target="_self">ApiBoot AliYun SMS</a></li></ul></li><li style="height:144px;overflow:hidden" class="menu-item menu-item-level-2"><span>运维指南<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/deploy.html" target="_self">打包部署</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/domain.html" target="_self">域名解析</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/nginx-load-balance.html" target="_self">Nginx负载均衡</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>开源共建<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/contribution.html" target="_self">贡献源码</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/conventions.html" target="_self">编码约定</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/new-starter.html" target="_self">新建组件</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-boot-plan.html" target="_self">ApiBoot规划</a></li></ul></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>ApiBoot 集成极光App消息推送</h1>
<p><code>消息推送</code>是接口服务项目内不可或缺的一部分，用于向用户发送操作消息提醒、广告等。</p>
<p><code>ApiBoot</code>内提供了<code>消息推送</code>的支持，目前集成的第三方组件为<code>极光推送</code>，<code>ApiBoot</code>遵循开箱即用的原则，所以在集成推送时仍然只需要简单的必要配置即可完成集成。</p>
<h2>添加依赖</h2>
<p>在<code>pom.xml</code>配置文件添加依赖如下所示：</p>
<pre><code class="language-xml">//...
  <span class="hljs-comment">&lt;!--ApiBoot Message Push Starter--&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.minbox.framework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>api-boot-starter-message-push<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
//...
</code></pre>
<blockquote>
<p>注意：如果未添加<code>ApiBoot</code>版本依赖，请访问<a href="/zh-cn/docs/version-rely.html">版本依赖</a>查看添加方式。</p>
</blockquote>
<h2>相关配置</h2>
<table>
<thead>
<tr>
<th>配置名称</th>
<th>默认值</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>api.boot.push.production</code></td>
<td><code>true</code></td>
<td>配置IOS平台的推送环境，true：生产环境(AppStore下载的APP)</td>
</tr>
<tr>
<td><code>api.boot.push.client.master-secret</code></td>
<td></td>
<td>单客户端推送配置masterSecret</td>
</tr>
<tr>
<td><code>api.boot.push.client.app-key</code></td>
<td></td>
<td>单客户端推送配置appKey</td>
</tr>
<tr>
<td><code>api.boot.push.multiple.xxx.master-secret</code></td>
<td></td>
<td>多客户端推送配置masterSecret</td>
</tr>
<tr>
<td><code>api.boot.push.multiple.xxx.app-key</code></td>
<td></td>
<td>多客户端推送配置appKey</td>
</tr>
</tbody>
</table>
<blockquote>
<p>在上面<code>multiple</code>相关的配置内部是key-&gt;value结构配置，其中&quot;xxx&quot;用于配置@MessagePushSwitch(&quot;xxx&quot;)的value值</p>
</blockquote>
<h2>单环境推送</h2>
<p>如果你的接口服务项目只集成推送到一个APP客户端，那么可以采用<code>单环境推送</code>的模式，该环境使用<code>api.boot.push.client</code>前缀的配置进行配置极光推送的两个秘钥，如下所示：</p>
<pre><code class="language-yaml"><span class="hljs-comment"># ApiBoot Config</span>
<span class="hljs-attr">api:</span>
<span class="hljs-attr">  boot:</span>
<span class="hljs-attr">    push:</span>
      <span class="hljs-comment"># 推送默认配置</span>
<span class="hljs-attr">      client:</span>
        <span class="hljs-comment"># 秘钥</span>
<span class="hljs-attr">        master-secret:</span> <span class="hljs-string">xxx</span>
        <span class="hljs-comment"># appKey</span>
<span class="hljs-attr">        app-key:</span> <span class="hljs-string">xxx</span>
</code></pre>
<p>配置完成后我们就可以通过注入<code>ApiBootMessagePushService</code>接口来进行发送推送业务，如下所示：</p>
<pre><code class="language-java"><span class="hljs-comment">/**
 * ApiBoot Message Push Service
 */</span>
<span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> ApiBootMessagePushService apiBootMessagePushService;

<span class="hljs-comment">/**
  * 安卓推送示例
  * <span class="hljs-doctag">@see</span> org.minbox.framework.api.boot.plugin.message.push.model.PushClientConfig
  */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>{
  apiBootMessagePushService.executePush(
    MessagePushBody.builder()
    <span class="hljs-comment">// 推送安卓平台</span>
    <span class="hljs-comment">// 如需更换推送平台，可以查看PusherPlatform枚举定义</span>
    .platform(PusherPlatform.ANDROID)
    <span class="hljs-comment">// 标题</span>
    .title(<span class="hljs-string">"消息推送"</span>)
    <span class="hljs-comment">// 内容</span>
    .message(<span class="hljs-string">"测试消息推送内容"</span>)
    <span class="hljs-comment">// 接收人的别名(App端开发人员进行设置)</span>
    .alias(Arrays.asList(<span class="hljs-string">"xxxx"</span>))
    .build()
  );
}
</code></pre>
<blockquote>
<p><code>ApiBoot Message Push</code>如不配置使用<code>@MessagePushSwithc</code>注解时，使用默认的配置，也就是<code>api.boot.push.client</code>开头的相关配置信息。</p>
</blockquote>
<h2>多环境推送</h2>
<p>在一个接口服务系统内，可能存在向多个APP客户端进行推送消息，那么这种情况<code>ApiBoot Message Push</code>也做了支持，内部通过<code>AOP</code>的方法切面进行处理。</p>
<p>多环境下的配置要做修改，如下所示：</p>
<pre><code class="language-yaml"><span class="hljs-comment"># ApiBoot Config</span>
<span class="hljs-attr">api:</span>
<span class="hljs-attr">  boot:</span>
<span class="hljs-attr">    push:</span>
<span class="hljs-attr">      multiple:</span>
        <span class="hljs-comment"># user app 推送配置</span>
<span class="hljs-attr">        user:</span>
<span class="hljs-attr">          master-secret:</span> <span class="hljs-string">xxx</span>
<span class="hljs-attr">          app-key:</span> <span class="hljs-string">xxxx</span>
        <span class="hljs-comment"># other app 推送配置</span>
<span class="hljs-attr">        other:</span>
<span class="hljs-attr">          master-secret:</span> <span class="hljs-string">xxxxxx</span>
<span class="hljs-attr">          app-key:</span> <span class="hljs-string">xxxxxx</span>
</code></pre>
<p>在上面我们配置了两个APP客户端的推送信息，名称分别为<code>user</code>、<code>other</code>，这个名称对应<code>@MessagePushSwitch</code>注解的<code>value</code>值使用。</p>
<p>在上面配置了<code>user</code>、<code>other</code>两个客户端，使用具体的环境我们只需要在调用方法上添加<code>@MessagePushSwitch</code>注解，如下所示：</p>
<pre><code class="language-java"><span class="hljs-comment">// other app 推送</span>
<span class="hljs-meta">@MessagePushSwitch</span>(<span class="hljs-string">"other"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testOther</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-comment">//....</span>
}

<span class="hljs-comment">// user app 推送</span>
<span class="hljs-meta">@MessagePushSwitch</span>(<span class="hljs-string">"user"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testUser</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-comment">//....</span>
}
</code></pre>
<h2>指定别名推送</h2>
<p>在推送消息时，<code>ApiBoot</code>提供了多种方式，其中可以根据<code>alias</code>别名进行推送，<code>alias</code>是由<code>App</code>前端开发人员在集成<code>SDK</code>时设置的值，这时就需要接口开发人员与APP开发人员的约定来完成推送逻辑，一般可以使用用户的编号来作为别名，根据别名推送如下所示：</p>
<pre><code class="language-java"><span class="hljs-comment">// 别名推送示例</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>{
  apiBootMessagePushService.executePush(
    MessagePushBody.builder()
    .platform(PusherPlatform.ANDROID)
    .title(<span class="hljs-string">"消息推送"</span>)
    .message(<span class="hljs-string">"测试消息推送内容"</span>)
    <span class="hljs-comment">// 配置别名，别名可配置多个</span>
    .alias(Arrays.asList(<span class="hljs-string">"xxxx"</span>))
    .build()
  );
}
</code></pre>
<h2>指定分组推送</h2>
<p>分组推送跟别名推送几乎一致，也是APP开发人员在调用<code>SDK</code>时对具体的用户划分的一个分组群体，向分组进行推送消息时，分组内的所有用户都可以收到。</p>
<p>如下所示：</p>
<pre><code class="language-java"><span class="hljs-comment">// 分组推送示例</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>{
  apiBootMessagePushService.executePush(
    MessagePushBody.builder()
    .platform(PusherPlatform.ANDROID)
    .title(<span class="hljs-string">"消息推送"</span>)
    .message(<span class="hljs-string">"测试消息推送内容"</span>)
    <span class="hljs-comment">// 推送group1内的所有用户</span>
    <span class="hljs-comment">// 注意：分组优先级低于别名</span>
    .tags(Arrays.asList(<span class="hljs-string">"group1"</span>))
    .build()
  );
}
</code></pre>
<blockquote>
<p>如果同时配置别名、分组两种推送方式，则会使用别名</p>
</blockquote>
<h2>携带自定义参数推送</h2>
<p><code>ApiBoot Message Push</code>可以给APP端推送的消息携带自定义的扩展参数，让APP端做一些特殊的处理，携带扩展参数如下所示：</p>
<pre><code class="language-java"><span class="hljs-comment">// 自定义参数示例</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>{
  apiBootMessagePushService.executePush(
    MessagePushBody.builder()
    .platform(PusherPlatform.ANDROID)
    .title(<span class="hljs-string">"消息推送"</span>)
    .message(<span class="hljs-string">"测试消息推送内容"</span>)
    .alias(Arrays.asList(<span class="hljs-string">"xxxx"</span>))
    <span class="hljs-comment">// 扩展参数</span>
    .extras(<span class="hljs-keyword">new</span> HashMap(<span class="hljs-number">1</span>) {
      {
        put(<span class="hljs-string">"role"</span>, <span class="hljs-string">"USER"</span>);
      }
    })
    .build()
  );
}
</code></pre>
<h2>自定义推送提示声音</h2>
<p><code>ApiBoot Message Push</code>可以推送自定义提示的声音，当然也需要APP开发人员做配置才可以，如下所示：</p>
<pre><code class="language-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>{
  apiBootMessagePushService.executePush(
    MessagePushBody.builder()
    .platform(PusherPlatform.ANDROID)
    .title(<span class="hljs-string">"消息推送"</span>)
    .message(<span class="hljs-string">"测试消息推送内容"</span>)
    .alias(Arrays.asList(<span class="hljs-string">"xxxx"</span>))
    <span class="hljs-comment">// 手机系统默认提示音</span>
    .sound(<span class="hljs-string">"default"</span>)
    .build()
  );
}
</code></pre>
<p><code>sound</code>方法可以设置与<code>APP</code>开发人员约定的声明唯一名称。</p>
<h2>设置推送角标数值</h2>
<p>推送消息时<code>APP</code>的角标数值是可以自定义的，当然我们一般都是叠加，如下所示：</p>
<pre><code class="language-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>{
  apiBootMessagePushService.executePush(
    MessagePushBody.builder()
    .platform(PusherPlatform.ANDROID)
    .title(<span class="hljs-string">"消息推送"</span>)
    .message(<span class="hljs-string">"测试消息推送内容"</span>)
    .alias(Arrays.asList(<span class="hljs-string">"xxxx"</span>))
    .tags(Arrays.asList(<span class="hljs-string">"group1"</span>))
    <span class="hljs-comment">// 角标数值，默认为+1</span>
    .badge(<span class="hljs-number">999</span>)
    .build()
  );
}
</code></pre>
</div></section><footer class="footer-container"><div class="footer-body"><img src="/img/apiboot-gray.png"/><div class="cols-container"><div class="col col-12"><h3>愿景</h3><p>ApiBoot致力于解决快速开发接口服务、集成第三方依赖</p></div><div class="col col-6"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/introduce.html" target="_self">概览</a></dd><dd><a href="/zh-cn/docs/quick-start.html" target="_self">快速开始</a></dd><dd><a href="/zh-cn/docs/faq.html" target="_self">开发者指南</a></dd></dl></div><div class="col col-6"><dl><dt>资源</dt><dd><a href="/zh-cn/blog/index.html" target="_self">博客</a></dd><dd><a href="/zh-cn/community/index.html" target="_self">社区</a></dd></dl></div></div><div class="copyright"><span>Copyright © 2019 恒宇少年 - 于起宇</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
	</script>
	<script src="/build/documentation.js"></script>
</body>

</html>